<!-- 배열 명 Matches 
  establishment가 '미성립'인 애들 사용
]
{
    match_id: 86,
    home_userid: 9,
    away_userid: null,
    match_date: 2023-05-17T15:00:00.000Z,
    match_time: null,
    match_place: '강서구,구로구',
    match_time_start: '01:08:00',
    match_time_end: '23:08:00',
    created: 2023-05-29T19:08:32.000Z,
    updated: null,
    establishment: '미성립'
  },
  {
    match_id: 101,
    home_userid: 2,
    away_userid: 11,
    match_date: 2023-05-29T15:00:00.000Z,
    match_time: '10:50:00',
    match_place: '동대문구',
    match_time_start: '08:53:00',
    match_time_end: '14:53:00',
    created: 2023-05-30T02:54:12.000Z,
    updated: null,
    establishment: '성립'
  },
  {
    match_id: 102,
    home_userid: 1,
    away_userid: null,
    match_date: 2023-04-30T15:00:00.000Z,
    match_time: null,
    match_place: '구로구,종로구',
    match_time_start: '06:19:00',
    match_time_end: '06:20:00',
    created: 2023-05-30T12:19:58.000Z,
    updated: null,
    establishment: '미성립'
  }
] -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">  

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;500;700&family=Raleway:wght@200;300;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/public/stylesheets/common.css">
  <link rel="stylesheet" href="/public/stylesheets/list.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js" integrity="sha512-H6cPm97FAsgIKmlBA4s774vqoN24V5gSQL4yBTDOY2su2DeXZVhQPxFK4P6GPdnZqM9fg1G3cMv5wD7e6cFLZQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script defer src="../public/javascripts/main.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <title>match_list</title>
</head>
<body>
<!--HEADER-->
  <header>
    <%- include ("./header.ejs") %>
  </header>

    <section class="Team">
      <!-- <h1>등록된 경기 목록</h1> -->
      <div class="matchedInfo__card">
        <div class="top">
          <div class="match_date">날짜</div>
          <div class="match_place">장소</div>
          <div class="match_time_start">경기 시작 시간</div>
          <div class="teamname">팀 정보</div>
          <div class="request_match">경기 요청하기</div>
        </div>

        
        <% for (var i=0;  i < Matches.length; i++) { %>
          <!-- '성립'된 경기 또는 날짜 지난 경기는 pass(continue)하고 '미성립'만 렌더링 -->
          <% let today = new Date(); %>
          <% let year = today.getFullYear(); %>
          <% let month = ('0' + (today.getMonth() + 1)).slice(-2); %>
          <% let day = ('0' + today.getDate()).slice(-2); %>
          <% let hours = ('0' + today.getHours()).slice(-2); %>
          <% let minutes = ('0' + today.getMinutes()).slice(-2); %>
          <% let seconds = ('0' + today.getSeconds()).slice(-2); %>


          <% let dateString = year + '-' + month  + '-' + day; %>
          <% let timeString = hours + ':' + minutes  + ':' + seconds; %>

          <% let now = new Date(dateString + ' ' + timeString); %>
          <% let matchDate = new Date(Matches[i].match_date + ' ' + Matches[i].match_time); %>

          <% if (Matches[i].establishment == '성립' || now >= matchDate ){continue;}; %> 
          <!-- <% var data = Matches[i]; %> -->
          <div class="edit">
            <form action="/matching/request" method="post">
              <input type="hidden" name="match_id" value="<%= Matches[i].match_id %>">
              <input type="hidden" name="home_userid" value="<%= Matches[i].home_userid %>">
              <input type="hidden" name="match_date" value="<%= Matches[i].match_date %>">
              <input type="hidden" name="teamname" value="<%= Matches[i].home_teamname %>">
              <input type="hidden" name="match_place" value="<%= Matches[i].match_place %>">
              <input type="hidden" name="match_time" value="<%= Matches[i].match_time  %>">
              <div class="match_date"><%= Matches[i].match_date %></div>
              <div class="match_place"><%= Matches[i].match_place %></div>
              <div class="match_time_start"><%= Matches[i].match_time %></div>
              <div class="teamname" data-modal-id="<%= i %>">
                <%= Matches[i].hometeamInfo.teamname %>
              </div>

              <button class="request_match enter fade-in" type="submit" >
                경기 요청
              </button>
            </form>
          </div>
        <%  } %>
              
        </div>
    </section>

  <!-- Team information modals -->
  <% for (var i=0; i < Matches.length; i++) { %>
    <div class="black_bg" id="black_bg_<%= i %>"></div>
    <div class="modal_wrap" id="modal_<%= i %>">
      <div class="modal_body">
        <div class="modal_close" id="modal_close_<%= i %>">
          <a href="javascript:void(0)">close</a>
        </div>
        <div class="team_info">
          <%= Matches[i].hometeamInfo.teamname %>
        </div>
      </div>
    </div>
    <% } %>
  
  <script>
    // JavaScript to handle modals
    document.addEventListener('DOMContentLoaded', function () {
      const modalButtons = document.querySelectorAll('[data-modal-id]');
      const modalCloses = document.querySelectorAll('[id^="modal_close_"]');
      const blackBgs = document.querySelectorAll('[id^="black_bg_"]');
      modalButtons.forEach(button => {
        const modalId = button.getAttribute('data-modal-id');
        button.addEventListener('click', () => {
          document.getElementById(`modal_${modalId}`).style.display = 'block';
          document.getElementById(`black_bg_${modalId}`).style.display = 'block';
        });
      });
      modalCloses.forEach(close => {
        const modalId = close.id.split('_')[2];
        close.addEventListener('click', () => {
          document.getElementById(`modal_${modalId}`).style.display = 'none';
          document.getElementById(`black_bg_${modalId}`).style.display = 'none';
        });
      });
    });
  </script>


</body>
</html>